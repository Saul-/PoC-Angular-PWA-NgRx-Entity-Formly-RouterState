<mat-progress-bar *ngIf="loading$ | ngrxPush" class="progress-bar--top" mode="indeterminate"></mat-progress-bar>

<ng-container *ngrxLet="character$ as character">
  <ng-container *ngIf="character; else loadingCharacter">
    <seo
      *transloco="let t"
      [config]="{
        title: t('CHARACTERS.SEO_DETAILS.title', { name: character.name }),
        description: t('CHARACTERS.SEO_DETAILS.description', { name: character.name }),
        keywords: t('CHARACTERS.SEO_DETAILS.keywords'),
        details_keywords: [character.name, t('CHARACTERS.CHARACTER_EPISODES', { name: character.name })],
        image: character.image
      }"
    ></seo>

    <h1>{{ character.name }}</h1>
    <mat-divider></mat-divider>
    <app-character-details-card
      [character]="character"
      (prefetchLocation)="prefetchLocation($event)"
    ></app-character-details-card>
    <mat-card *transloco="let t">
      <h2>{{ t('CHARACTERS.CHARACTER_EPISODES', { name: character.name }) }}</h2>
      <div class="row">
        <mat-list role="list" *ngrxLet="episodes$ as episodes">
          <ng-container *ngFor="let episode of episodes; trackBy: episode?.id">
            <mat-list-item *ngIf="episode; else loadingEpisode" role="listitem">
              <button mat-button color="primary" [routerLink]="['/episodes', episode.id] | localize">
                {{ episode.episode }}: {{ episode.name }}
              </button>
            </mat-list-item>

            <ng-template #loadingEpisode>
              <app-loading-episode></app-loading-episode>
            </ng-template>
          </ng-container>
        </mat-list>
      </div>
    </mat-card>
  </ng-container>

  <ng-template #loadingCharacter>
    <app-loading-character></app-loading-character>
  </ng-template>
</ng-container>
