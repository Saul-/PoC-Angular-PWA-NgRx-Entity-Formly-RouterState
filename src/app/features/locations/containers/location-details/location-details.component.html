<ng-container *ngrxLet="dataState$ as dataState">
  <mat-progress-bar
    *ngIf="dataState === dataStateTypes.LOADING || dataState === dataStateTypes.REFRESHING"
    class="progress-bar--top"
    mode="indeterminate"
  ></mat-progress-bar>
</ng-container>

<ng-container *transloco="let t">
  <ng-container *ngrxLet="location$ as location">
    <ng-container *ngIf="location; else loadingLocation">
      <h1>{{ location.name }}</h1>
      <h3>{{ t('LOCATIONS.FIELDS.TYPE') }}: {{ location.type }}</h3>
      <h3>{{ t('LOCATIONS.FIELDS.DIMENSION') }}: {{ location.dimension }}</h3>
      <mat-divider></mat-divider>
      <mat-card>
        <h2>{{ t('LOCATIONS.LOCATION_RESIDENTS', { name: location.name }) }}</h2>
        <div class="row" *ngrxLet="charactersDataState$ as charactersDataState">
          <mat-progress-bar
            *ngIf="charactersDataState === dataStateTypes.LOADING"
            mode="indeterminate"
          ></mat-progress-bar>

          <ng-container *ngrxLet="characters$ as characters">
            <ng-container *ngIf="!!characters.length; else emptyCharacters">
              <div class="col-12 col-md-6" *ngFor="let character of characters; trackBy: character?.id">
                <app-character-mini-card
                  *ngIf="character; else loadingCharacter"
                  [character]="character"
                ></app-character-mini-card>
                <ng-template #loadingCharacter>
                  <app-loading-character-mini-card></app-loading-character-mini-card>
                </ng-template>
              </div>
            </ng-container>

            <ng-template #emptyCharacters>
              <p *ngIf="charactersDataState === dataStateTypes.LOADED">{{ t('LOCATIONS.NO_RESIDENTS') }}</p>
            </ng-template>
          </ng-container>
        </div>
      </mat-card>
    </ng-container>

    <ng-template #loadingLocation>
      <app-loading-details-content></app-loading-details-content>
    </ng-template>
  </ng-container>
</ng-container>
